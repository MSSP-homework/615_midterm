---
title: "615 Midterm"
author: "Amie Thomas"
date: "2023-10-30"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

install.packages("sf")
install.packages("leaflet")
library(readr)
library(tidyverse)
library(lubridate)
library(ggplot2)
library(viridis)
#library(sf)
#library(leaflet)
```

-How dangerous are floods? 
-How expensive? 
-Is there any pattern to the kinds of communities that suffer losses from floods?

###<NOAA>###


#load in the NOAA data and merge
```{r}
Mydata <- read_csv("StormEvents_details-ftp_v1.0_d2020_c20230927.csv.gz")
Mydata_2 <- read_csv("StormEvents_details-ftp_v1.0_d2021_c20231017.csv.gz")
noaa_20_21 <- rbind(Mydata, Mydata_2)
#how much damage was done
```

#get rid of columns not of interest
```{r}
noaa_20_21 <- Mydata |>
  filter(EVENT_TYPE == "Flood") |>
   select(-MAGNITUDE, -MAGNITUDE_TYPE, -CATEGORY, -TOR_F_SCALE, -TOR_LENGTH, -TOR_WIDTH, 
          -TOR_OTHER_WFO, -TOR_OTHER_CZ_STATE, -TOR_OTHER_CZ_FIPS, -TOR_OTHER_CZ_NAME, -BEGIN_RANGE,
          -BEGIN_AZIMUTH, -END_RANGE, -END_AZIMUTH, -CZ_TIMEZONE, -DATA_SOURCE, -WFO)
```

#change damage data into useable intergers
```{r}
noaa_20_21$DAMAGE_PROPERTY <- str_replace_all(noaa_20_21$DAMAGE_PROPERTY, "[^0-9.]", "")
noaa_20_21$DAMAGE_PROPERTY <- as.numeric(noaa_20_21$DAMAGE_PROPERTY)
noaa_20_21$DAMAGE_PROPERTY <- round(noaa_20_21$DAMAGE_PROPERTY)
options(scipen = 999)
noaa_20_21$DAMAGE_PROPERTY <- noaa_20_21$DAMAGE_PROPERTY*100000


noaa_20_21$DAMAGE_CROPS <- str_replace_all(noaa_20_21$DAMAGE_CROPS, "[^0-9.]", "")
noaa_20_21$DAMAGE_CROPS <- as.numeric(noaa_20_21$DAMAGE_CROPS)
noaa_20_21$DAMAGE_CROPS <- round(noaa_20_21$DAMAGE_CROPS)
options(scipen = 999)
noaa_20_21$DAMAGE_CROPS <- noaa_20_21$DAMAGE_CROPS*100000

```

#filter out events with no damage
#organize by most property damage
```{r}
noaa_20_21 <- arrange(noaa_20_21, desc(DAMAGE_PROPERTY))
noaa_20_21 <- noaa_20_21 %>%
  filter(DAMAGE_PROPERTY != 0 | DAMAGE_CROPS != 0)

noaa_20_21 <- noaa_20_21 |>
  mutate(DAMAGE_TOTAL = DAMAGE_CROPS + DAMAGE_PROPERTY)|>
  relocate(DAMAGE_TOTAL, .before = SOURCE)

options(scipen = 999) #out of sci. notation


```


#NOAA Questions
-what types of flood causes result in the most damage
```{r}


```

#
-what months have the most floods
-what types of flood causes happen in which months
-what states have the most damage
-what states have what types of flood causes
-can I look at the spread of the event
-what states have the most crop damage
-how many of each flood cause happened 
-which state has the most floods

#create a total damage column












###<FEMA>###

#load in the FEMA data and merge
```{r}
Mydata_3 <- read_csv("FemaWebDisasterSummaries.csv")
Mydata_4 <- read_csv("DisasterDeclarationsSummaries.csv")
fema_data <- left_join(Mydata_3, Mydata_4, "disasterNumber")
#how much relief was sent
```

#filter to keep only columns of interest
```{r}
fema_data$incidentBeginDate <- year(fema_data$incidentBeginDate)
fema_data_int <- fema_data |> 
  filter(incidentType == "Flood") |>
  filter(incidentBeginDate == "2020" | incidentBeginDate ==  "2021")|>
  select(-hash.x, -lastRefresh.x, -id.x, -declarationType, -disasterCloseoutDate, 
         -tribalRequest, -lastRefresh.y, -id.y, -hash.y, -iaLoadDate, -lastIAFilingDate, -ihProgramDeclared, -iaProgramDeclared, -paProgramDeclared, -hmProgramDeclared)|>
  relocate(designatedArea, .before = declarationDate)

#take care of NA's
fema_data_int$totalNumberIaApporved[is.na(fema_data_int$totalNumberIaApproved)] <- 0
fema_data_int$totalAmountIhpApproved[is.na(fema_data_int$totalAmountIhpApproved)] <- 0
fema_data_int$totalAmountHaApproved[is.na(fema_data_int$totalAmountHaApproved)] <- 0
fema_data_int$totalAmountOnaAproved[is.na(fema_data_int$totalAmountOnaAproved)] <- 0

#need to figure out what these mean and what is the actually amount sent as relief to help people in these areas
```

#FEMA Questions
-what counties receive the most relief
-further what are the demographics in this area 
-how long did it take for this area to receive support

#Need to know 
-totalnumberIaapproved
-totalamountihpapproved
-totalamounthaapproved
-totalamountOnaapproved
-so many different variables what the hell is the one that tells me the information i want to know
